<!DOCTYPE html>
<html lang="zh_cn">
<head>
    <meta charset="utf-8">
    <title>邓德昭的技术博客 - ADF</title>
    <meta name="description" content="">
    <meta name="author" content="pierreorz">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://pelican.dengdezhao.cn/theme/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="http://pelican.dengdezhao.cn/theme/bootstrap.min.css" rel="stylesheet">
    <link href="http://pelican.dengdezhao.cn/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="http://pelican.dengdezhao.cn/theme/local.css" rel="stylesheet">
    <link href="http://pelican.dengdezhao.cn/theme/pygments.css" rel="stylesheet">

    <!-- So Firefox can bookmark->"abo this site" -->

</head>

<body>

<div class="navbar">
    <div class="navbar-inner">
    <div class="container">

         <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
             <span class="icon-bar"></span>
         </a>

        <a class="brand" href="http://pelican.dengdezhao.cn">邓德昭的技术博客</a>

        <div class="nav-collapse">
        <ul class="nav">
            <li><a href="http://pelican.dengdezhao.cn">Home</a></li>
            <li><a href="about.html">About</a></li>
            
        </ul>
        </div>
        
    </div>
    </div>
</div>

<div class="container">
    <div class="content">
    <div class="row">

        <div class="span9">
        

        


    <div class='article'>
        <div class="content-title">
            <a href="http://pelican.dengdezhao.cn/fen-ye-lan-chu-xian-3ge-wen-hao-bugjie-jue.html"><h1>"<af:table>分页栏出现3个问号BUG解决"</h1></a>
2013-06-06(Thursday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 
        </div>
        
        <div><hr />
<p>平台：Jdeveloper 11.1.1.7.0</p>
<hr />
<p><strong>BUG描述</strong>
标准控件af:table，“页”字前后出现三个问号。</p>
<p><strong>原因分析</strong></p>
<p _="%" endcodeblock="endcodeblock">查看LOG文件  <br />
{% codeblock lang:java %}
<RenderingContext> <getTranslatedString> 无法从外观 mySkin.desktop 获取资源关键字 页  <br /></p>
<p>可见是RenderingContext类中getTranslatedString方法发生异常。  <br />
查看源代码分析：    </p>
<p><strong>找到源代码所在位置</strong>：  </p>
<p><strong>将JAR包解压得到RenderingContext类，反编译查看</strong>    </p>
<p _="%" endcodeblock="endcodeblock">结果如下<strong>RenderingContext.class</strong>：  <br />
{% codeblock lang:java %}
  public String getTranslatedString(String key)
  {
    if (key == null)
      return null;
    try
    {
      return getSkin().getTranslatedString(getLocaleContext(), key);
    }
    catch (MissingResourceException mre)
    {
      _LOG.severe("CANNOT_GET_RESOURCE_KEY", new String[] { key, getSkin().getId() }); }
    return "???" + key + "???";
  }</p>
<p>可知在调用getTranslatedString获取Resource时，发生MissingResourceException异常所以返回了带"???"+Key+"???"字样的字符串。    </p>
<p><strong>解决方案：</strong></p>
<p>根据以上分析基本可知出现问号的原因是在获取resourcebundle时，找不到Key为页的resource，所以直接返回了"???" + key + "???"，就出现分页显示出现问号的BUG。    </p>
<p><strong>方案一：</strong>重写ResourceBundle类，增加KEY值为“页”的资源。
步骤如下：    </p>
<ul>
<li>
<p _="%" endcodeblock="endcodeblock">创建SkinBundle类 extends ListResourceBundle   <br />
{% codeblock lang:java %}
package cn.dengdezhao.bundle
public class SkinBundle extends ListResourceBundle {
    @Override
    public Object[][] getContents() {
        System.out.println("executing...");
        return  new Object[][]{ { "页", "页" } };
    }
}</p>
</li>
<li>
<p _="%" endcodeblock="endcodeblock">创建trinidad-skins.xml文件注册定制化Skin  <br />
{% codeblock lang:xml %}
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
<skins xmlns="http://myfaces.apache.org/trinidad/skin">
    <skin>
        <id>mySkin.desktop</id>
        <family>mySkin</family>
        <extends>skyros-v1.desktop</extends> 
        <render-kit-id>org.apache.myfaces.trinidad.desktop</render-kit-id>
        <style-sheet-name>css/mySkin.css</style-sheet-name>
        <bundle-name>cn.dengdezhao.bundle.SkinBundle</bundle-name>
        <!--<bundle-name>ApplicationBundle</bundle-name>-->
    </skin>
</skins></p>
</li>
<li>
<p _="%" endcodeblock="endcodeblock">修改trinidad-config.xml文件如下：  <br />
{% codeblock lang:xml %}
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
<trinidad-config xmlns="http://myfaces.apache.org/trinidad/config">
  <skin-family>mySkin</skin-family>
</trinidad-config></p>
</li>
<li>
<p>创建css/mySkin.css文件（内容默认CSS即可）</p>
</li>
</ul>
<p>运行即发现问号消失。</p>
<p _="%" endcodeblock="endcodeblock"><strong>方案二：</strong>其实原理跟方案一一样，也是通过改resourcebundle实现。resourcebundle支持三种类型，一种是以上的扩展ListResourceBundle类实现，一种是通过配置文件properties实现，另外一种是xliff实现。也可创建一个ApplicationBundle.properties文件，内容如下:  <br />
{% codeblock lang:java %}
页 = 页</p>
<p>trinidad-skins.xml里的bundle-name节点设置成ApplicationBundle也可实现同样效果。</p>
<p>定制CSS可参照["定制CSS"]</p></div>
        <hr />
    </div>
		

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/adftreezuo-de-shu-cai-dan-ru-he-guo-lu-zi-jie-dian-de-shu-ju.html"><h2>adf:tree做的树菜单如何过滤子节点的数据？</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>需求：项目中的树菜单需要权限用户的权限过滤显示子菜单，通过用户所在的用户组可以查看的页面ID（List)过滤子节点<br />
解决方案：<br />
因为树是通过viewLink关联自身的VO生成的，想在AM里添加方法，对VO进行过滤处理把结果返回。<br />
但实现起来比较麻烦，调用方法之后要刷新页面，初始化的树数据过滤处理困难。<br />
于是想重写VO的方法看能不能在VO层就过滤掉子节点。重写createViewLinkAccessorRS，此方法返回ViewLink的结果，也就是菜单的子节点数据
<div>
<blockquote>
@Override<br />
protected ViewRowSetImpl createViewLinkAccessorRS(AssociationDefImpl associationDefImpl,<br />
ViewObjectImpl viewObjectImpl,<br />
Row row,<br />
Object[] object) {<br />
ViewRowSetImpl viewRowSetImpl =<br />
super.createViewLinkAccessorRS(associationDefImpl, viewObjectImpl,<br />
row, object);<br />
int count = 0;<br />
// getList()拿到可以查看的pageId的列表，对比Row中的pageId属性，如果在List中存在，就取该Row，如果不存      //在，表示此子节点不予以显示，remove掉<br />
if (this …</blockquote></div></p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/adftreezuo-de-shu-cai-dan-ru-he-guo-lu-zi-jie-dian-de-shu-ju.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/biao-nei-de-checkboxdang-shu-ju-liang-da-shi-fa-xian-bu-fen-xing-gou-xuan-bu-zhong.html"><h2>表内的checkbox当数据量大时发现部分行勾选不中</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>测试发现，当数据只有25行的时候，都可以正常勾选，超过25行的数据，总是勾选不中。</p>

<p>问题产生原因：<br />
由于自定制的checkbox是设置了immediate=true 即时给数据行的checkbox字段赋值。<br />
VO的rangeSize 默认是25，<br />
因此导致25条数据内是可选。25条之外的数据初始时没有取出来，因此对这些没取的数据行设置checkbox自然就不生效了（展现出来就是checkbox勾选不中）</p>

<p>解决方案：<br />
修正VO的rangeSize为-1，查询全部，即可解决此问题。</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/biao-nei-de-checkboxdang-shu-ju-liang-da-shi-fa-xian-bu-fen-xing-gou-xuan-bu-zhong.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/guan-yu-ding-zhi-validator.html"><h2>关于定制validator</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>一个时刻字段，要求输入00:00-12:60这样的时刻范围<br />
使用如下的正则表达式，过滤掉了不合规则的数字之后，还差一个逻辑，结束时刻不能小于开始时刻，比如：10：00-9：00这样的输入也是不合法的。正则太折磨眼力了，应该也是可以做到这点的吧，为了偷懒，就定制个validator来处理这个点。
<div>
<blockquote>&lt;af:validateRegExp pattern="([0-1][0-9]|2[0-4])\:([0-5][0-9]|60)\-([0-1][0-9]|2[0-4])\:([0-5][0-9]|60)" messageDetailNoMatch="请输入时刻，例如 00：00-24：60 " hint="请输入时刻，例如 00：00-24：60"/&gt;</blockquote>
</div>
<strong>Step1</strong>。创建一个<strong>ValidatorTime</strong>类实现Validator接口
<div>
<blockquote>package …</blockquote></div></p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/guan-yu-ding-zhi-validator.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/guan-yu-managedbeanzhong-duo-ci-zhi-xing-gou-zao-fang-fa-shi-de-wen-ti.html"><h2>关于ManagedBean中多次执行构造方法时的问题</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>有时候需要在初始化时执行一些查询，但发现会多次执行。需要在构造方法里添加一行代码避免页面点击时多次执行初始化。<br />
if (!(Boolean)ADFUtils.getBindObject("adfFacesContext.postback")) {<br />
init()；<br />
}</p>

<p>通过页面是否postback来控制只初始化一次。</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/guan-yu-managedbeanzhong-duo-ci-zhi-xing-gou-zao-fang-fa-shi-de-wen-ti.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/guan-yu-selectbooleancheckbox-de-wen-ti.html"><h2>关于selectBooleanCheckbox 的问题</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>页面的 selectBooleanCheckbox 选择后，总提示 不是数字（组件value是 true 或 false,数据库存的是Number），怎么解决</p>

<p>方案有三个<br />
1。如果是基于表的Number字段(假设字段名是Flag，值是1或者0），想生成selectBooleanCheckbox ，可以重写这个VO的的 setFlag()跟getFlag()方法如下：<br />
public void setFlag(Boolean value){<br />
this.flag=value==true?1:0;<br />
}
public Boolean getFlag(){<br />
return this.flag==0?false:true;<br />
}</p>

<p>2。设置valueChangeListener.<br />
在valueChange方法里捕获当前selectBooleanCheckbox 的值，然后转化成Number类型的传给VO</p>

<p>3。如果是只读的表，可以在UI上通过EL表达式处理。</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/guan-yu-selectbooleancheckbox-de-wen-ti.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/guan-yu-vode-zhi-du-ke-xie-deng-shu-xing-she-zhi.html"><h2>关于VO的只读可写等属性设置</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>如果生成ViewObject 的时候选择的是只读的VO的话，会发现VO的source里有ReadOnly="true"。<br />
需求1：在MB中我通过代码拿到这个VO的实例，我想通过以下代码添加Row
<div>
<blockquote>Row newRow=Vo.createRow();<br />
newRow.setAttribute("attribute1","value1");<br />
newRow.setAttribute("attribute2","value2");<br />
newRow.setAttribute("attribute3","value3");<br />
Vo.insertRow(newRow);</blockquote>
</div>
最终发现，只读VO无法插入数据。怎么办？将ReadOnly改成"false"之后测试，发现满足需求~！<br />
需求2：满足需求1之后发现，Vo里的确插入数据了。如果页面上有保存按钮，也会将这个数据更改到数据库，而这个数据只是需要在MB中起过渡作用，不必将newRow的数据postChange到DB，怎么办？<br />
VO里 这个属性DeleteParticipant 立功了。 DeleteParticipant就是控制数据是否保存到DB的。设置 DeleteParticipant="false"发现满足了需求！</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/guan-yu-vode-zhi-du-ke-xie-deng-shu-xing-she-zhi.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/immediatetrue-de-yi-chang.html"><h2>immediate="true" 的异常</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>设置按钮的immediate="true" 可以避免因按钮提交FORM导致的页面刷新闪烁，但也会带来麻烦。<br />
假如对表的取消按钮设置了此属性，可能会发生新增数据，然后点取消作rollback时数据显示异常。<br />
开发时值得注意</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/immediatetrue-de-yi-chang.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/oracleshu-ju-ku-yong-hu-bei-suo-wen-ti-jie-jue.html"><h2>oracle数据库用户被锁问题解决</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>运行AM的时候报个JDBC连接错误，ORA-280000:用户被锁的异常。<br />
于是在PL/SQL DEV里切换成SYSTEM用户 alter user XXX account unlock;之后，用PL/SQL DEV测试 可以连上了<br />
再运行AM的时候，又报了个用户被锁。很是蛋疼<br />
于是换到命令行，尝试以SYSDBA的身份再执行一次alter account unlock;<br />
发现连不上：报了以下错误：<br />
ORA-28056: Writing audit records to Windows Event Log failed<br />
这你妹的，原来是系统日志满了，解决方案：<br />
打开windows 事件查看器，将应用程序日志清理一下，重新连接数据库，连接成功。</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/oracleshu-ju-ku-yong-hu-bei-suo-wen-ti-jie-jue.html">read more</a></div>
    </div>	
				

 
        

 

    <div class='article'>
        <a href="http://pelican.dengdezhao.cn/ru-he-zai-mbzhong-dui-selectionlistener-collectionmodelmakecurrentdiao-yong.html"><h2>如何在MB中对selectionListener collectionModel.makeCurrent调用</h2></a>
        <div class= "well small"> 2012-06-26(Tuesday) 00:00

by <a class="url fn" href="http://pelican.dengdezhao.cn/author/pierreorz.html">pierreorz</a>
 


 </div>
        <div class="summary"><p>如何在MB中对Table的默认"#{bindings.PromotionVO1.collectionModel.makeCurrent}"进行调用？</p>

<p>当需要重写adf:table的缺省的selectListener时，可以在自己绑定的MB的方法里，调用默认的makeCurrent方法。取得当前行的数据，进行自己的定制操作。方法如下：
<div>
<blockquote>//调用缺省makeCurrent<br />
JSFUtils.resolveMethodExpression("#{bindings.yourVO.collectionModel.makeCurrent}",<br />
new Class[] { SelectionEvent.class },<br />
new Object[] { selectionEvent });</blockquote>
</div>
取得选中行的数据
<div>
<blockquote>Row selectedRow =<br />
(Row)JSFUtils.resolveExpression("#{bindings.yourVOIterator.currentRow}");</blockquote>
</div>
然后就可以针对取得的数据进行定制开发了。</p> <a class="btn btn-info xsmall" href="http://pelican.dengdezhao.cn/ru-he-zai-mbzhong-dui-selectionlistener-collectionmodelmakecurrentdiao-yong.html">read more</a></div>
    </div>	
				
<div class="pagination">
<ul>
    <li class="prev disabled"><a href="#">&larr; Previous</a></li>

    <li class="active"><a href="http://pelican.dengdezhao.cn/tag/adf.html">1</a></li>
    <li class=""><a href="http://pelican.dengdezhao.cn/tag/adf2.html">2</a></li>

    <li class="next"><a href="http://pelican.dengdezhao.cn/tag/adf2.html">Next &rarr;</a></li>

</ul>
</div>
 
  
        </div>
        
        <div class="span3">

            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Site
                </li>
            
                <li><a href="http://pelican.dengdezhao.cn/archives.html">Archives</a>
                <li><a href="http://pelican.dengdezhao.cn/tags.html">Tags</a>




            </ul>
            </div>


            <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
            <ul class="nav nav-list">
                <li class="nav-header"> 
                Categories
                </li>
                
                <li><a href="http://pelican.dengdezhao.cn/category/about.html">About</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/adf.html">ADF</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/ebs.html">ebs</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/java.html">java</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/linux.html">linux</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/octopress.html">octopress</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/oracle.html">oracle</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/others.html">others</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/sinaapp.html">sinaapp</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/soa.html">soa</a></li>
                <li><a href="http://pelican.dengdezhao.cn/category/webcenter.html">webcenter</a></li>
                   
            </ul>
            </div>





        </div>  
    </div>     </div> 
<footer>
<br />
<p><a href="http://pelican.dengdezhao.cn">邓德昭的技术博客</a> &copy; pierreorz 2013</p>
</footer>

</div> <!-- /container -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script src="http://pelican.dengdezhao.cn/theme/bootstrap-collapse.js"></script>
 
</body>
</html>